<html>

<head>
<style>
html {
    overflow: hidden;
    overscroll-behavior: none;
}
#updateTextarea {
  display: block;
  overflow: hidden;
  resize: none;
  height:800px;
  width:500px;
}


table {
  background-image: repeating-linear-gradient(15deg, rgba(255,255,255, .1), rgba(255,255,255) 1px, transparent 1px, transparent 1px);
  background-color:#E3F8F2;
  margin:auto;
  width: 500px;
  border-radius:10px;
}
tr {

  border-top: 12px solid transparent;
  border-bottom: 12px solid transparent;
  }


.paddedCell{
  padding-top:20px;
  padding-bottom:20px;
  padding-left:10px;
  text-align: center;
  }
.menu{
  padding:10px;
  
}
.menuBalloon{
  background-image: repeating-linear-gradient(90deg, rgba(255,255,255, .1), rgba(255,255,255,.5) 1px, transparent 1px, transparent 1px);
  background-color:#AAECD9;
  border-radius:15px;
  padding-left:15px;
  padding-top:3px;
  padding-bottom:3px;
}
.numInp{
  background-image: repeating-linear-gradient(15deg, rgba(255,255,255, .4), rgba(255,255,255) 3px, transparent 1px, transparent 1px);
  background-color:#DBE6E3;
  width:60px;
  border-radius:5px;
  padding:4px;
}

.customSubmitButton{
  
  padding:4px;
  background-image: repeating-linear-gradient(15deg, rgba(255,255,255, .4), rgba(255,255,255) 3px, transparent 1px, transparent 1px);
  background-color:#DBE6E3: ;
//  background-color:#AAECD9;
  border:3px solid;
  border-top: 2px solid black;
  border-right: 2px solid gray;
  border-bottom: 3px solid gray;
  border-left: 2px solid black;
  border-radius:5px;
}

.customSubmitButton:active {
  background-color: #AAECD9;
  border-top: 3px solid black;
  border-bottom: 2px solid gray;
  border-right: 3px solid gray;
  border-left: 1px solid black;
  
  transform: translateY(1px);
}

.menuCheckbox{
  //border-radius:50%;
}


body{
  cursor:default;
  background-color:#78B14E;
  font-family:"Georgia","Tinos";
  letter-spacing:-1px;
  font-size:1.1em;
}
.mainTable, th, td {
  //border: 1px solid black;
  border-collapse: collapse;
  border-spacing:0px;
}
td {
  margin-left:auto;
  margin-right:auto;
  margin:0 auto;
  vertical-align: top;
  text-align:center;
  
  width:40px;
}


.spacer1{
  height:10px;
 
}

.emptyStock {
  width: 20px;
  height:30px;  
  border:0px;
 background-image: repeating-linear-gradient(15deg, rgba(255,255,255, .1), rgba(255,255,255) 1px, transparent 1px, transparent 1px);
  background-color:#E3F8F2;
  margin:auto;
}
.faceDownCard { 
  
  position: relative;
  border-radius: 2px;
  word-wrap: break-word;
  //background-color:#EF896B;
  background-image: repeating-linear-gradient(-40deg, rgba(255,255,255, 0.25), rgba(50,50,50) 2px, transparent 1px, transparent 10px);
  background-size: 2px 4px;
  box-shadow: 0 0 0 1px #ffffff,inset 0 0 0 1px #fff;
  width: 20px;
  height:30px;  
  background-color:#EF896B;
  padding: 1px 1px;
  border-top:    1px solid  #DF481C;
  border-right:  1px solid #DF481C;
  border-bottom: 1px solid #DF481C;
  border-left:   1px solid  #DF481C;
  color: #000;
  color: rgba(0, 0, 0, 0.1);
}
.face1 {
  font-family:inherit;
  font-size:1.2em;
  border:0px solid;
  padding:1px 0px;
  padding-right: 1px;
  width: 35px;
  line-height: 73%;
}
.topcard1 { 
  position: relative;
  border-radius: 2px;
  word-wrap: break-word;
  //background-color:#EF896B;
  background-color:#ffffff;
  background-image: repeating-linear-gradient(-90deg, rgba(255,255,255, .90), rgba(50,50,50,.10) 2px, transparent 1px, transparent 10px);
  background-size: 2px 4px;
  box-shadow: 0 0 0 1px #ffffff,inset 0 0 0 1px #fff;
  width: 25px;
  height:43px;  
  //background-color:#EF896B;
  padding: 1px 2px;
  padding-top:2px;
  border-top:    1px solid  #DF481C;
  border-right:  1px solid #DF481C;
  border-bottom: 1px solid #DF481C;
  border-left:   1px solid  #DF481C;
  color: #000;
  color: rgba(0, 0, 0);
  line-height:79%;
  display: inline-block;
}

.notTop{
  position: relative;
  background-color:#ffffff;
  background-image: repeating-linear-gradient(-90deg, rgba(255,255,255, .90), rgba(50,50,50,.10) 2px, transparent 1px, transparent 10px);
  background-size: 2px 4px;
  box-shadow: 0 0 0 1px #ffffff,inset 0 0 0 1px #fff;
  width: 27px;
  height:13px;
 // box-shadow: 0 0 0 1px #716F6E,inset 0 0 0 1px #fff;
  //background-color:#ECF2E7;
  border-radius: 2px 2px 0px 0px;
  border: 1px solid gray;
  border-bottom: 0px solid;
  
  padding: 0px 1px;
  padding-top: 4px;
  display: inline-block;
}
.downArrow{
  position: relative;
 // background-color:#ffffff;
 // background-image: repeating-linear-gradient(-90deg, rgba(255,255,255, .90), rgba(50,50,50,.10) 2px, transparent 1px, transparent 10px);
 // background-size: 2px 4px;
 // box-shadow: 0 0 0 1px #ffffff,inset 0 0 0 1px #fff;
  width: 28px;
  height:13px;
 // box-shadow: 0 0 0 1px #716F6E,inset 0 0 0 1px #fff;
  //background-color:#ECF2E7;
  border-radius: 2px 2px 0px 0px;
  border: 0px solid gray;
  border-bottom: 0px solid;
  
  padding: 0px 1px;
  padding-top: 4px;
  display: inline-block;
}
.foundationPush{
  
}
.invis {
  //background-color: #78B14E;
  background-color:#AAECD9;
  border: 1px solid;
}


svg {
  
  width: auto;
  height:auto;
}
.circle {
  
  position:absolute;
  display:inline-block;
  fill-opacity:0;
  width: auto;
  height:auto;
}

.theCircle {
  stroke-dasharray: 1000;
  stroke-dashoffset: 1000;
  animation: dash .3s linear forwards 1;
  //animation-iteration-count: 1;
  z-index:1;
}
.theCircleOff {
  stroke-dasharray: 1000;
  stroke-dashoffset: 985;
  animation: dashOff .3s linear forwards 1;
  z-index:1;
}
@keyframes dash {
  from {
    stroke-dashoffset: 1000;
  }
  to {
    stroke-dashoffset:10;
  }
}
@keyframes dashOff {
  from {
    stroke-dashoffset:10;
  }
  to {
    stroke-dashoffset:1000;
    opacity:0;
  }
}

.heartPip{
  position:absolute;
  display:inline-block;
  fill:#DF481C;
  fill-opacity:100;
}
.spadePip{
  stroke:black;
  position:absolute;
  display:inline-block;
  fill:black;
  fill-opacity:100;
}
.clubPip{
  position:absolute;
  display:inline-block;
  fill:black;
  fill-opacity:100;
}
.diamondPip{
  
  position:absolute;
  display:inline-block;
  fill:#DF481C;
  fill-opacity:100;
}
.bellPip{
  stroke:black;
   position:absolute;
  display:inline-block;
  fill:#FFF231;
  fill-opacity:100;
}

	
.acornPericarp{
    stroke:black;
    stroke-width:6;
   position:absolute;
  display:inline-block;
  fill:#9C5F08;
  fill-opacity:100;
}
.acornCapule{
    stroke:black;
    stroke-linecap:"round";
    stroke-width:6;
   position:absolute;
  display:inline-block;
  fill:#FFBC08;
  fill-opacity:100;
}
.acornStem{
    stroke:black;
    stroke-width:6;
   position:absolute;
  display:inline-block;
  fill:#FFBC08;
  fill-opacity:100;
}
.acornTexture{
  stroke:black;
  stroke-linecap:round;
    stroke-width:6;
   position:absolute;
  display:inline-block;
  fill:#9C5F08;
  fill-opacity:0;
}
.fishBody{
  //stroke:#32C4CB;
  stroke:#1D7E83;
  stroke-linecap:round;
    stroke-width:5;
   position:absolute;
  display:inline-block;
  fill:#37EDF6;
  fill-opacity:100;
}
.fishTexture{
   stroke:#1D5877;
  stroke-linecap:round;
    stroke-width:3;
   position:absolute;
  display:inline-block;
  fill:#20A1E6;
  fill-opacity:100;
}

.sunBody{
     stroke:#FFE5AC;
  stroke-linecap:round;
    stroke-width:2;
   position:absolute;
  display:inline-block;
  fill:#F8BC3B;
  fill-opacity:100;
}
.sunHalo{
   stroke:#FFE5AC;
  stroke-linecap:round;
    stroke-width:3;
   position:absolute;
  display:inline-block;
  fill:#FFE5AC;
  fill-opacity:100;  
}
.sunFlare{
   stroke:#f8bv3b;
  stroke-linecap:round;
    stroke-width:1;
   position:absolute;
  display:inline-block;
  fill:#F8BC3B;
  fill-opacity:100;  
}
</style>
</head>
<meta charset="UTF-8">
<header Content-Type: text/html; charset='utf-8'>

<body>
<div id="banana"></div>
<div id="yo"></div>
<br>
<span id='yi'></span>

<br>


<!--<div id='difficultySelector'></div>-->

<svg>
<symbol id="squircle1" >
<path fill="white" stroke="royalblue" stroke-width="4" d="M36,26.482c72-34.667,127.667-1.333,132.333,31.333	c6.895,48.277-48.122,96.228-92.667,84c-35.378-9.711-73-48-66.333-82.667c5.148-26.771,34.181-56.445,89-57.333 C148.666,1,187.25,57.732,173.75,85.732c-9.334,28-55.749,71.917-102.5,62.5c-42.5-11.5-73.769-65.847-69.583-93.75 c2-13.333,10.667-43.333,54-53.482"/>
</symbol>
<symbol id="heart">
<path class="heartPip" stroke-width="1" d="M 72 51 Q 68 40 72 32 Q 78 21 91 12 Q 95 9 99 8 Q 107 5 113 5 Q 129 7 132 30 Q 132 33 109 66 Q 93 88 79 113 Q 61 137 64 146 L 60 148 Q 55 126 50 110 Q 40 85 21 65 Q 11 58 4 47 Q -1 16 29 0 Q 41 -2 52 2 Q 82 30 72 51"/>
</symbol>
<symbol id="spade">
<path class="spadePip" stroke-width="1" d="M 74.2 129.2 Q 91.3 143.45 120.75 143.45 L 26.7 143.45 Q 55.2 143.45 74.2 129.2 A 0.95 0.95 90 0 0 74.2 129.2 A 0.95 0.95 90 0 0 74.2 129.2 Q 101 118 131.2 125.4 Q 155 70 74.2 5.7 Q -6 71 15.3 123.5 Q 45 118 74 129"/>
</symbol>
<symbol id = "club">
<path class="clubPip" stroke="black" stroke-width="1" d="M 74.2 129.2 Q 91.3 143.45 120.75 143.45 L 26.7 143.45 Q 55.2 143.45 74.2 129.2 Q 132 124 141 85 Q 111 46 74.2 129.2 Q 37 47 7 81 Q 16 126 74.2 129.2 Q 146 28 74.2 5.7 Q -1 29 74 129"/>
</symbol>
<symbol id = "diamond">
<path class="diamondPip" stroke-width="1" d="M 75 148 L 20 75 L 75 5 L 130 76 L 75 148"/>
</symbol>
<symbol id ="bell">
<path class="bellPip" stroke-width="6" d="M 124 19 M 50 126 Q 62 125 57 115 Q 45 112 50 126 M 114 145 Q 87 142 63 128 Q 87 142 114 145 Q 135 133 127 104 Q 121 68 131 52 Q 142 38 131 25 Q 122 16 108 11 Q 96 7 84 27 Q 71 42 37 54 Q 9 61 14 91 Q 22 105 43 116 Q 22 105 14 91 Q 11 72 37 83 Q 70 95 95 114 Q 123 135 114 145 M 118 15 Q 141 -11 124 19"/>
</symbol>
<symbol id="acorn">
<path class="acornPericarp" d="M 101 25 Q 76 17 52 31 Q 22 47 16 69 Q 15 90 18 101 Q 21 114 16 127 Q 33 125.5 51 130 Q 73 144 111 117 Q 141 96 132 70 Q 129 56 120 44 "/>
<path class="acornCapule" d=" M 125 33 Q 136 44 142 56 Q 153 79 144 94 Q 137 106 126 93 Q 96 66 78 33 Q 69 16 86 12 Q 98 11 107 18 Q 118 23 124 32 "/>
<path class="acornStem" d="M 117 40 Q 121 31 124 24 Q 127.5 28 136 32 Q 126 36 124 46 "/>
<path class="acornTexture" d=""/>

<!--
<symbol id="acorn">
<path class="acornPericarp" d="M 111 43.25 Q 119.1 37.85 125.85 41.9 Q 139.35 52.7 139.35 93.2 Q 136.65 116.15 129.9 129.65 Q 125.85 137.75 128.55 145.85 Q 119.1 140.45 108.3 141.8 Q 102.9 143.15 92.1 145.85 Q 81.3 148.55 67.8 145.85 Q 42.15 135.05 32.7 110.75 Q 30 99.95 32.7 85.1 Q 32.7 81.05 36.75 78.35 Q 62.4 72.95 82.65 60.8 Q 106.95 48.65 111 43.25 "/>
<path class="acornCapule" d="M 101.55 50 Q 120.45 37.85 121.8 18.95 Q 120.45 8.15 106.95 6.8 Q 96.15 5.45 82.65 10.85 Q 69.15 16.25 51.6 24.35 Q 47.55 27.05 42.15 29.75 Q 32.7 28.4 25.95 35.15 Q 16.5 44.6 12.45 60.8 Q 9.75 75.65 15.15 86.45 Q 28.65 82.4 34.05 79.7 Q 54.3 74.3 73.2 66.2 Q 88.05 59.45 101.55 50 "/>
<path class="acornStem" d=" M 59.7 20.3 Q 61.05 16.25 57 12.2 Q 48.9 5.45 40.8 6.8 Q 38.1 10.85 39.45 17.6 Q 40.8 23 46.2 27.05 Q 52.95 24.35 59.7 20.3 "/>
<path class="acornTexture" d="M 52.95 27.05 Q 35.4 45.95 32.7 63.5 M 79.95 20.3 Q 59.7 48.65 44.85 63.5 M 98.85 17.6 Q 81.3 43.25 65.1 64.85 M 100.2 25.7 Q 89.4 41.9 79.95 54.05 M 70.5 41.9 Q 63.75 52.7 58.35 63.5 M 24.6 55.4 Q 40.8 62.15 55.65 70.25 M 32.7 45.95 Q 46.2 51.35 58.35 52.7 M 40.8 39.2 Q 52.95 45.95 59.7 48.65 Q 70.5 50 81.3 51.35 M 62.4 25.7 Q 82.65 28.4 102.9 28.4 M 71.85 106.7 L 67.8 109.4 L 67.8 106.7 M 34.05 74.3 L 36.75 81.05"/>
</symbol>
<symbol id="fish">
<path class="fishBody" d="M 46 149 Q 35 139 24 125 Q 15 101 28 100 Q 28 110 38 106 Q 47 103 52 99 Q 60 91 63 82 Q 70 73 69 37 Q 64 33 62 26 Q 61 16 69 10 Q 76 7 88 10 Q 100 15 108 22 Q 112 26 115 34 Q 119 43 117 56 Q 114 65 110 70 Q 102 82 92 93 Q 86 95 72 105 Q 66 113 59 115 Q 51 117 52 122 Q 50 129 53 136 Q 54 147 46 149"/>
<path class="fishTexture" d="M 70 66 Q 79 67 90 64 M 125 63 Q 123 55 129 48 Q 130 39 119 44"/>
</symbol>
-->


<symbol id="fish">
<path class="fishBody" d=" M 31.669 105.066 Q 37.78 111.311 46.423 116.237 Q 54.005 120.776 63.706 122.771 Q 79.424 125.643 94.057 131.412 Q 102.409 142.409 105.804 149.655 Q 113.766 148.088 114.037 143.491 Q 117.823 140.246 124.853 140.246 Q 143.377 135.206 142.745 131.834 Q 132.417 124.246 111.34 120.663 Q 107.968 121.928 103.963 120.452 Q 99.9585 118.3445 95.954 116.237 Q 83.94 109.5975 71.926 102.958 Q 67.5 97.689 63.074 92.42 Q 44.811 59.392 32.302 27.082 Q 27.234 18.289 20.288 10.009 Q 18.581 8.824 16.072 7.691 Q 12.902 6.661 10.803 4.318 Q 8.846 3.957 7.245 5 Q 5.601 7.472 3.872 11.323 Q 2.626 15.044 3.029 19.543 Q 2.085 25.049 3.451 29.238 Q 3.167 38.84 4.519 47.223 Q 4.789 51.55 6.682 56.958 Q 8.305 65.882 11.82 76.158 Q 12.361 80.755 17.151 85.092 Q 22.366 95.087 28.111 101.11 Q 29.397 103.74 32.115 105.326 "/>
<path class="fishTexture" d="M 4.083 45.678 Q 2.897 56.147 4.505 66.544 Q 3.708 70.749 5.137 72.235 Q 6.142 70.749 7.666 70.97 Q 9.247 71.708 10.828 72.446 Q 6.142 59.019 4.082 45.627 M 15.886 84.249 Q 13.984 90.76 16.518 98.792 Q 19.121 106.714 23.052 111.86 Q 25.611 114.015 29.165 113.546 Q 31.29 111.311 32.115 108.066 Q 31.6935 106.0635 30.867 103.111 Q 22.625 94.663 16.032 84.155 M 16.729 10.901 Q 23.66 20.758 33.169 27.13 Q 38.835 36.566 40.968 44.624 Q 44.948 52.795 46.448 60.853 Q 46.634 69.235 51.295 77.926 Q 51.692 79.142 52.56 80.666 Q 55.065 88.415 59.305 94.366 Q 63.074 98.532 68.157 100.689 Q 72.98 104.645 78.274 107.433 Q 83.729 109.703 88.18 108.698 Q 93.846 111.811 97.243 116.707 Q 97.851 120.663 101.248 124.716 Q 98.199 121.4335 95.15 118.151 Q 92.471 114.03 88.35 112.382 Q 83.612 110.528 78.667 109.91 Q 72.898 106.613 68.159 102.699 Q 64.45 101.05 61.978 100.226 Q 60.33 96.723 56.827 92.809 Q 54.561 88.482 53.324 86.01 Q 52.912 79.417 49.616 71.587 Q 48.6885 68.0845 47.761 64.582 Q 45.804 61.0795 43.847 57.577 Q 41.58 52.426 38.284 47.687 Q 37.666 41.918 35.811 37.591 Q 34.781 34.295 31.897 30.998 Q 27.364 27.083 21.801 21.314"/>
</symbol>

<symbol id="sun">
<path class="sunHalo" d="M 75 132 A 1 1 0 0 0 75 18 A 1 1 0 0 0 75 132" />
<path class="sunFlare" d="M 38 40 Q 38 21 16 19 Q 19 36 38 40 M 26 76 Q 14 64 1 76 Q 14 89 27 76 M 41 111 Q 15 119 23 131 Q 37 131 41 111 M 75 124 Q 65 142 74 148 Q 88 142 75 124 M 105 114 Q 128 119 121 134 Q 108 133 105 114 M 123 76 Q 140 63 148 76 Q 137 86 123 76 M 110 42 Q 119 17 133 20 Q 133 37 110 42 M 75 27 Q 63 12 75 3 Q 87 12 75 27"/>
<path class="sunBody" d="M 75 120 A 1 1 0 0 0 75 30 A 1 1 0 0 0 75 120"/>
</symbol>
</svg>


<!--
<svg id="heartPip" viewBox="0 0 150 150" height=".7em" width=".5em"><use xlink:href="#heart"/></svg><br>
<BR>
<svg id="spadePip" viewBox="0 0 150 150" height=".7em" width=".5em"><use xlink:href="#spade"/></svg>
<br><br>
<svg id="clubPip" viewBox="0 0 150 150" height=".7em" width=".5em"><use xlink:href="#club"/></svg><br>
<br>
<svg id="diamondPip" viewBox="0 0 150 150" height=".7em" width=".5em"><use xlink:href="#diamond"/></svg><br>
<svg id="bellPip" viewBox="0 0 150 150" height=".7em" width=".5em"><use xlink:href="#bell"/></svg><br>
<svg id="acornPip" viewBox="0 0 150 150" height="3em" width="3em"><use xlink:href="#acorn"/></svg><br>
<svg id="fishPip" viewBox="0 0 150 150" height="3em" width="3em"><use xlink:href="#fish"/></svg><br>
<svg id="sunPip" viewBox="0 0 150 150" height="3em" width="3em"><use xlink:href="#sun"/></svg><br>
-->
</body>

<script>	
/*
//options menu
var menu = {suits:4,legs:10,kOnA:false,relaxed:true};
//relaxed means dealing is allowed to empty leg
var gameVersions = {classic:true, nineLegs:false, spiderette:false,willowisp:false,custom:false};
//Will o' the Wisp by Geoffrey Mott-Smith is played with 21 cards delt to seven legs of three with only the top card of each column face-up
var gameDifficulty = {easy:false,medium:true,hard:false};
*/
var theUpdate=`
BETA COOKIE VERSION: Load closed or crashed game should work. NOTE: will load previous state, so if you do something and it does not work it will keep the previous state (same goes for if you get stuck, it will load the previous state). I have not extensivly tested it. If you close the window, click LOAD GAME!! to load previous tableu. Happy focusing!
` ;
var updates = '<table><tr><td>' + theUpdate + '</td></tr><tr><td><button class="customSubmitButton" onclick="mainMenu()">Exit to Menu</button></td></tr></table>';

var loadStatus = 0;
var game = {version:'Classic',difficulty:'medium',decks:2,suits:4,kOnA:true,relaxed:true,legs:10,wildCard:false,noFaceCards:false,custom:false,dealFaceDown:44};
//var drawDeck = []

//var xlinks={spade:'<svg class="circle" viewBox="0 0 150 150" height=".7em" width=".5em"><use xlink:href="#spade"/></svg>',heart:'<svg class="circle" viewBox="0 0 150 150" height=".7em" width=".5em"><use xlink:href="#heart"/></svg>',club:'<svg class="circle" viewBox="0 0 150 150" height=".7em" width=".7em"><use xlink:href="#club"/></svg>',diamond:'<svg class="circle" viewBox="0 0 150 150" height=".7em" width=".5em"><use xlink:href="#diamond"/></svg>'}



var xlinkPips={spade:'<use xlink:href="#spade"/></svg>',heart:'<use xlink:href="#heart"/></svg>',club:'<use xlink:href="#club"/></svg>',diamond:'<use xlink:href="#diamond"/></svg>',bell:'<use xlink:href="#bell"/></svg>',acorn:'<use xlink:href="#acorn"/></svg>',fish:'<use xlink:href="#fish"/></svg>',sun:'<use xlink:href="#sun"/></svg>'}

var svgCard = '<svg class="circle" viewBox="0 0 150 150" height=".6em" width=".6em" style="align-items: center;">'

var svgCustomPip = '<svg class="circle" viewBox="0 0 150 150" height=".6em" width".6em" style="padding-top:10px;">'

var pipNames = ['spade','heart','club','diamond','bell','acorn','fish','sun'];


var xlinks={spade:svgCard + xlinkPips.spade,heart:svgCard + xlinkPips.heart,club:svgCard + xlinkPips.club,diamond:svgCard + xlinkPips.diamond,bell:svgCard + xlinkPips.bell,acorn:svgCard + xlinkPips.acorn,fish:svgCard + xlinkPips.fish, sun:svgCard + xlinkPips.sun}

var suitPipsStart = [xlinks.spade + '&nbsp;&nbsp;',xlinks.heart + '&nbsp;&nbsp;',xlinks.club + '&nbsp;&nbsp;',xlinks.diamond + '&nbsp;&nbsp;',xlinks.bell + '&nbsp;&nbsp;',xlinks.acorn + '&nbsp;&nbsp;',xlinks.fish + '&nbsp;&nbsp;',xlinks.sun + '&nbsp;&nbsp;']
var suitPips = ['&#9824','<svg id="heartPip" style="z-index:0" viewBox="0 0 146 147" height="2em"><use xlink:href="#heart"/></svg>','&#9827','<span style="color:#DF481C;">&#9830</span>','<span style="color:#FFB10B;font-size:.7em;">&#9728</span>','<span style="color:#0EE77A;font-size:.8em;">&#9752</span>','<span style="color:#015CF3;">&#9829</span>','<span style="color:pink">&#10049</span>','&#9826']
//var suitPipSelection = ['&#9824','<svg id="heartPip" style="z-index:0" viewBox="0 0 146 147" height="2em"><use xlink:href="#heart"/></svg>','&#9827','<span style="color:#DF481C;">&#9830</span>','<span style="color:#FFB10B;font-size:.7em;">&#9728</span>','<span style="color:#0EE77A;font-size:.8em;">&#9752</span>','<span style="color:#015CF3;">&#9829</span>','<span style="color:pink">&#10049</span>','&#9826']


var highCard = 13;

var menuModeArr =['Classic','Spiderette','9Legs','Tarantula','Will o Wisp','Custom','What is new?','How to play','LOAD GAME!!'];
var menuDifficultyArr = ['easy','medium','hard'];
var menuCustomizeNum = ['decks','suits','legs'];


function vv23() {
  let output = radioSelection(document.getElementById('vv22').value);
  document.getElementById('vv26').innerHTML = output;
}

const numberSelection = (x) =>{
  let output = ['<input class="numInp" type="number" id="','" name="' + x[0] + '" value="' + x[2] + '"' + x[3] +' size="8"><label for="' + x[2] + '">' + x[1] + '</label>'];
  return output.join(x[0]);
  }

const checkboxSelection = (x) =>{
  let output = ['<td><input class="menuCheckbox" type="checkbox" id="' + x[0] + '" name="' + x[0] + '" ' + x[3] + '><label for="' + x[0] + '">','</label>']
  return output.join(x[1]);
  }

function radioSelection (key,value){
  let output = ['<input type="radio" onclick="menuUsr(\'' + key + '\',\'','\')" id="','" name="' + key + '" value="','"><label for="','">','</label>']
  return output.join(value);
}

const buttonSelection = (key,value,opr) =>{
  if(!opr){opr = '';}
  let output = ['<button class="customSubmitButton" onclick="menuUsr(\'' + key + '\',\'','\'),'  + opr + '" id="','" name="' + key + '" value="','">','</button>']
  return output.join(value);
}

function menuUsr(type,value){
  game[type] = value;
}
  
function mainMenu(){
  suitPips = [...suitPipsStart];
  game = {version:'Classic',difficulty:'hard',decks:2,suits:4,kOnA:false,relaxed:false,legs:10,wildCard:false,noFaceCards:false}
  document.getElementById('banana').innerHTML = '<table width="80%" class="tableMain" ><tr><td>' + genForm('Pick a game!','version',menuModeArr,buttonSelection,'menuSelection()',3) + '</td></tr></table><p id= "banana2"></p>';
}

function genForm(message,type,array,opr,opr2,column,row){
  let output = '<table class="menu"><tr><td>';
  output += '<form><div class="menuBalloon">' + message + '</div></td></tr><tr><td><table class="menuBalloon"><tr><td class="paddedCell">';
  let tableEnd = '</td></tr></table>';
  let colStart = '';
  let colEnd = '<br>';
  if(column){
  colStart='<tr><td class="paddedCell">';
  colEnd = '</td><td class="paddedCell">';
  } else {column = 1}
  let rows = Math.ceil(array.length/column);
  for(let i = 0;i <= array.length ;i+=rows){
    output += array.slice(i,i+rows).map(x => opr(type,x,opr2)).join('<br><br>');
  	output += colEnd;  
  };
  //output += array.slice(0,half).map(x => operation('type',x)).join('<br>');
//  output += colEnd;
//  output += array.slice(half).map(x => operation('type',x)).join('<br>');
  //output += array.map(x => operation('type',x)).join('')
  output += tableEnd + '</form>';
  output += tableEnd;
  console.log(output)
  return output;
}

//////////////////////customize menu
//['suits',' suits (max 8)',game.suits,'min="1" max="8"'],
var menuCustomizeObjNum=[['decks',' decks (max 99) ',game.decks,'min="1" max="99"'],['legs',' legs (max 20)',game.legs,'min="3" max="20"']];
var menuCustomizeObjChk=[['kOnA','King on Ace Stacking',game.kOnA],['relaxed','Deal to Empty Leg?',game.relaxed,'checked'],['wildCard','Wild Card',game.wildCard],['noFaceCards','A-10 Only?',game.noFaceCards]];



//var suitPipSelector = [['spade',suitPips[0],'','checked'],['heart',suitPips[1],'','checked']]
/////////////////////suit selector\\\\\\\\\\\\\\\\\\\\
var squircles1= '<use class="theCircle" xlink:href="#squircle1"/>';
var squircles1off= '<use class="theCircleOff" xlink:href="#squircle1"/>';
var suitPickStr = [false, false, false, false, false, false, false, false, false];
var suitPick = [];

//var suitPips2 = ['&#9824', '<span style="color:#DF481C;">&#9829</span>', '&#9827', '<span style="color:#DF481C;">&#9830</span>', '<span style="color:#FFB10B;font-size:.7em;">&#9728</span>', '<span style="color:#0EE77A;font-size:.8em;">&#9752</span>', '<span style="color:#015CF3;">&#9829</span>', '<span style="color:#FFC5E1;font-size:.8em;">&#10049</span>', '<span style="font-size:.8em;">&#9826</span>']
var suitPips2 = [...suitPipsStart];


function suitPipSelector() { 
  suitPick = [...suitPickStr]
  let output = [];
  for(i in suitPips){
  output.push('<td style="text-align:left;vertical-align:center;height:20px" onclick="pipOption(' + i + ')"><div><svg class="circle" id="pipSquircle' + i + '" style="z-index:0; padding-top:8;padding-left:2;" viewBox="0 0 180 150" height="1.6em"><use class="theCircleOff" xlink:href="#squircle1"/></svg></div><div style="z-index:1;font-size:2em;"/> &nbsp;' + svgCustomPip + xlinkPips[pipNames[i]] + '</div></td>');
  }
  return output.join('');
}


function pipOption(x){
    suitPick[x] ? suitPick[x] = false : suitPick[x] = true;
  if (suitPick[x]) {
    document.getElementById('pipSquircle' + x).innerHTML = squircles1;
  } else {
    document.getElementById('pipSquircle' + x).innerHTML = squircles1off;
  console.log('hey');
  }
  suitCustomCounter();
}

function suitCustomCounter(){
  let output=0;
  for(let x of suitPick){
    if(x){output++}  
  }
  game.legs = output;
  document.getElementById('suits').setAttribute('value',output)
}

var finalSuits= []
function specialSuitPick(){
  finalSuits =[];
  for(let i in suitPick){
    if(suitPick[i]){finalSuits.push(suitPips[i])}
    console.log(i)
  }
  suitPips = [...finalSuits];
}

///////////////////////\\\\\\\\\\\\\

function genCustomizeMenu(){
  suitPick = [...suitPickStr];
  let num = [...menuCustomizeObjNum];
  let chk = [...menuCustomizeObjChk];
  let output = '<table class="menu"><tr><td>';
  output += '<form><div class="menuBalloon">Customize!</div></td></tr><tr><td><table class="menuBalloon" style="padding-left:0px"><tr><td><table class="menuBalloon">';
	let tableEnd = '</td></tr></table>';
  let colStart='<td>';
  let colEnd = '</td><td>';
    //output += num.map(x => numberSelection(x)).join(colEnd);
    output += num.map(x => numberSelection(x)).join('</td>');
    output += '</td></tr><table class="menuBalloon" width="100%"><tr>';
    output += chk.slice(0,2).map(x => checkboxSelection(x)).join('</td>');
    output += '</tr><tr>';
    output += chk.slice(2).map(x => checkboxSelection(x)).join('</td>');
    output += '</tr></table></tr><tr><td><table><tr>'
    output += suitPipSelector();
    output += '</tr></table></tr><tr><td><table><td><button class="customSubmitButton" onclick="mainMenu()">Exit to Menu</button></td><td><button id="randomizeBut" class="customSubmitButton" onclick="randomize()">Randomize</button></td><td><button class="customSubmitButton" onclick="menuCustomSubmit()">Start Game</button><input type="hidden" value="4" id="suits" name="suits" value="4"></td></table></tr>';
  output += '</table></form>';
  output += tableEnd;
  console.log(output)
  return output;
}
var randomi = 1;
function randomize(){
  document.getElementById('decks').value = Math.floor(Math.random() * 5)+ randomi;
//  document.getElementById('suits').value = Math.floor(Math.random() * 6)+ randomi;
  document.getElementById('legs').value = Math.floor(Math.random() * 6) + 6 + randomi;
  randomi++;
  for(let i = 0;i <= 8; i++){
    if(Math.floor(Math.random() * 2) == 1){
    pipOption(i);
    }
  }
  for(let i of ['kOnA','relaxed','wildCard','noFaceCards']){
    if(Math.floor(Math.random() * 2) == 1){
  document.getElementById(i).checked = true
  	} else {document.getElementById(i).checked = false}
  }
}

function menuCustomSubmit(){
  specialSuitPick();
  game.difficulty = 'Custom';
  game.version = 'Custom';
  for(let i of ['decks','suits','legs']){
  	game[i] = parseInt(document.getElementById(i).value)
  }
  for(let i of ['kOnA','relaxed','wildCard','noFaceCards']){
  	game[i] = document.getElementById(i).checked
  }
  startGame();
}



///////////////////////////////////


function menuSelection(){
  console.log('hey');
   if(game.version == 'How to play'){
    window.location.href='https://htmlpreview.github.io/?https://github.com/docPoacher/spider-solitaire-/blob/main/howto4v3.html';
  }
  if(game.version == 'LOAD GAME!!'){
    loadStatus = 1;
		console.log('loadstatus = ' + loadStatus);
    console.log('loading cookie');
    getGame();
		console.log('cookie loaded');
  }
  if(game.version == 'What is new?'){
  document.getElementById('banana').innerHTML = updates
  }else if(game.version == 'Custom'){
  console.log('hello?');
  document.getElementById('banana').innerHTML = '<table width="80%"><tr><td>' + genCustomizeMenu() + '</td></td></table><br><p id="boarnana2"></p>';
    for(let i = 0;i <= 3; i++){
 pipOption(i);
		}
  }else if(game.version == 'LOAD GAME!!'){
		console.log('starting game');
	  startGame();
		console.log('game started');
  }else{
  document.getElementById('banana').innerHTML = '<table width="80%"><tr><td>' + genForm('How hard?','difficulty',menuDifficultyArr,buttonSelection,'startGame()',3) + '</td></td></table><p id="boarnana"></p>';
  }
  
}

function startGame(){
	if(game.version == 'LOAD GAME!!'){
		console.log('parsing game')
    game = JSON.parse(tempC.game);
		game.version = 'Custom';
		console.log('game parsed');
  }
  if(game.noFaceCards){highCard = 10};
	
  if(game.version == 'Tarantula'){
    game.kOnA = true;
  }
  
  if(game.version == 'Spiderette'){
 		game.decks = 1;
 		game.suits = 4;
  	game.legs = 7;
  } 
  if(game.version == 'Will o Wisp'){
    game.decks = 1;
    game.suits = 4;
    game.legs = 7;
  }
  if(game.difficulty == 'easy'){
      game.decks = 8;
      game.suits = 1;
  }
  if(game.difficulty == 'medium'){
      game.decks = 4;
      game.suits = 2;
  }
  if(game.difficulty == 'hard'){
    	game.relaxed = false;
  }
  if(game.version == 'Spiderette' || game.version == 'Will o Wisp'){
 		game.decks = 1;
 		game.suits = 4;
  	game.legs = 7;
    if(game.difficulty == 'easy'){
      game.decks = 4;
      game.suits = 1;
    }
    if(game.difficulty == 'medium'){
      game.decks = 2;
      game.suits = 2;
    }
  }
  if(game.version == '9Legs'){
    game.kOnA = true;
    game.decks = 3;
    game.suits = 3;
    game.legs = 9;
    if(game.difficulty == 'easy'){
      game.decks = 6;
      game.suits = 1;
    }
    if(game.difficulty == 'medium'){
      game.decks = 4;
      game.suits = 2;
    }
  }
  	console.log(game);
 console.log('game on')
  newGame();
}
function newGameDeal(){
  if(game.version == 'Classic' || game.version == 'Tarantula'){
  	deal(44);
  	deal(10,true);
  }
  if(game.version == 'Will o Wisp'){
  deal(14);
  deal(7, true);
  }
  if(game.version == 'Spiderette'){
  	for(let i = 6; i >= 0 ; i--){
  		deal(i);
    }
    deal(7,true);
  }
  if(game.version == 'Custom'){
  deal(game.legs * 4);
  deal(game.legs, true);
  }
  if(game.version == '9Legs'){
    if(game.difficulty == 'hard'){deal(game.legs * 9, true)}
    if(game.difficulty == 'easy'){deal(game.legs * 4, true)}
    if(game.difficulty == 'medium'){deal(game.legs * 6,true)}
  }
  if(loadStatus == 1){
    zipNsip('sip');
    loadStatus = 0;
  }
}

//var game = {version:'Classic',difficulty:'medium',decks:4,suits:2,kOnA:true,relaxed:true,legs:10,wildCard:false,noFaceCards:false};

mainMenu();
//document.getElementById('vv26').innerHTML = genMenu('Pick a game!',menuModeArr);
//document.getElementById('difficultySelector').innerHTML = genMenu('How hard?',menuDifficultyArr);
//document.getElementById('difficultySelector').innerHTML = '<table width=80%><tr><td>' + genForm('Pick a game!','version',menuModeArr,radioSelection) + '</td></tr></table>';
//document.getElementById('difficultySelector').innerHTML = '<table width="80%"><tr><td>' + genForm('Pick a game!','version',menuModeArr,radioSelection,2) + '</td></tr></table><p id= "banana"></p>';
//document.getElementById('banana').innerHTML = '<table width="80%"><tr><td>' + genForm('How hard?','difficulty',menuDifficultyArr,radioSelection,3) + '</td></td></table><p id="boarnana"></p>';
//document.getElementById('boarnana').innerHTML = '<table width="80%"><tr><td>' + genForm('Customize!','decks',menuCustomizeNum,numberSelection,2) + '</td></td></table><p id="boarnana2"></p>';


////////////////////////////////////// POPUP MENU CLASS

class menuOption {
  constructor(value,name,type) {
    this.value = value;
    this.type = type;
    this.name = name;
  }
}

/*
function genMenu(message,arr) {
  let output = '<form><p>' + message + '</p>';
  output += arr.map(x => radioSelection('version',x)).join('');
//  arr =  //
  output += '</form>';
  return output;
}
*/





////////////////////////////////assets\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
function deep2(obj){
  let output = {};
  function dive(objx){
    let list = Object.keys(objx);
    for(let key of list) {
      let bart = objx[key];
      if(!output[bart]) {output[bart] = 0}
      output[bart]++;
      if(typeof bart === 'object'){dive(bart)}
    }
  }
  dive(obj);
  return output;
}

class cardCreate {
  constructor(value,suit) {
    this.value = value;
    this.suit = suit;
    this.vis = false;
  }
}
//&#9752 clover, &#9733 solid star, &#9734 white star, &#9826 white diamond, &#9835 music, &#9790 moon,&#10051 pinwheel,
//<span style="color:#015CF3;"> blue, <span style="color:#DF481C;"> red, <span style="color:#FFB10B;"> orange, 0EE77A green


var suitnames = ['spd','hrt','clb','dia','eth']

var cardValues = ['1','2','3','4','5','6','7','8','9','10','11','12','13','0']
var placeHolder = 'bot';
var cardBack = '&#9617';
var emptyCellf = {value:0,suit:'&#8224',vis:true};
var emptyCell = '&#8224';
var stock = 'â–‘';
var faceDown = '<span class="faceDownCard" style="z-index:1">.... ..</span>';
var tableu = [];
var ctableu = [];
var foundation = [];
//var downArrow = '<span class="downArrow">&#711;</span>';
var downArrow = '<span class="downArrow">&#9660</span>';
//var cursor = {p:0,s:0,mode:'listless'}
const cursorStart = {leg:0, depth:0};
var scursor = {...cursorStart};
var pcursor = {leg: 0, depth:0};
var cursor = {search:0,searchDepth:0,stack:0,foundation:0};
var cursorMode = 'listless';

const suitBuild = (suit) => {
  let cards = [];
  cards = cardValues.slice(0,highCard)
/*  if(!game.noFaceCards){
  	cards = cardValues.slice(0,highCard)
  } else {
    cards = cardValues.slice(0,highCard)
  }
*/
  //if(game.wildCard){cards.push('Z')}
  this['setReq'] = [...cards];
  for(let pip of suitPips){
    this['suitOf' + pip] = [];
      for(let card of cards){
        this['suitOf' + pip].push(new cardCreate(card,pip))
      }
    }    
}
  
var testing1 = ''
const deckBuild = () => {
  suitBuild();
  this['drawDeck'] = [];
  for(let deck = 0;deck <= game.decks - 1; deck++){
    for(let suit = 0;suit <= game.suits - 1;suit++){
      if(game.version == '9Legs' && suit == 2){suit = 4};
      for(let card of this['suitOf' + suitPips[suit]]){
        let line = {}
        line['suit'] = card.suit;
        line['value'] = card.value;
        line['vis'] = false
        drawDeck.push(line);
      }
    }
  } 
  ////////////////////////
//testing1 = deep2(drawDeck);
  if(game.wildCard){drawDeck.push({suit: "&#9827", value: "Z", vis:false})}
}


function shuffle(array) {
  let currentIndex = array.length,  randomIndex;
  while (currentIndex != 0) {
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex--;
    [array[currentIndex], array[randomIndex]] = [
      array[randomIndex], array[currentIndex]];
	}
  return array;
}
////////////////////////////////Layout\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
function buildLayout(){
  tableu = [];
  foundation = [];
  this['legs'] = game.legs;
  this['sets'] = game.decks * game.suits;
  //setReq is cards required for set. It is assigned in the suitBuild function
  for(let i = 0;i <= legs-1;i++){
    this['leg' + i] = [placeHolder];
    tableu.push(this['leg' + i]);
  }
  for(let i = 0;i <= sets-1; i++){
    this['found' + i] = emptyCell;
    foundation.push(this['found' + i]);
  }
}

/////////////////////////////////////do we need this?
function tableuRefresh(){
  tableu=[];
  for(let i = 0;i <= legs-1;i++){
    tableu.push(this['leg' + i]);
  }
}

/////////////////////////////////deal\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\

function dealToLeg(leg,face) {
   let topCard = drawDeck.pop();
   topCard.vis = face
   tableu[leg].push(topCard);
}



const deal = (numberOfCards, face) => {
  for(let i of tableu){
    if (i.length <= 0){return}
  }
  if(drawDeck.length == 0){return}
  for(let i = 0; i < numberOfCards; i++){
    if(drawDeck.length == 0){return}
    dealToLeg(i % game.legs,face)
  }
}

const newDeal = (numberOfCards, face) => {
  if(drawDeck.length == 0){return}
  for(let i = 0; i < numberOfCards; i++){
    if(drawDeck.length == 0){return}
    dealToLeg(i % game.legs,face)
  }
}


const cellDiv = (data,id,message) =>{
  let cell = '<td><div';
  if(id){
    cell += ' id="' + id + '"';
  }
  cell += message + '>' + data + '</div></td>';
  return cell;
}

function visualFoundationBuild() {
  for(let i in foundation){
    this['found' + i] = foundation[i];
    document.getElementById('found' + i).innerHTML = this['found' + i];
  }
}
function visualTableBuild() {
  let output = '<table class="mainTable"><tr><td id="stock"><button class=faceDownCard onclick="buttonPress(13)">....</button></td><td><div id="stockNo"></div></td>'
  for(let i in foundation){
    output += cellDiv(emptyCell,`found` + i);
  }
  output += '</tr><tr><td class="spacer1"><div class="spacer1"></div></td></tr><tr>';
  for(let i in tableu){
    output += cellDiv(emptyCell,`cleg` + i);
    this['cleg' + i] = 'bot';
    ctableu.push(this['cleg' + i]);
  }
  output += '</tr></table>';
  document.getElementById('yo').innerHTML = output;
}	
/*
      for(let value = 1; value <= 13; value ++){
        this['card' + value + suit + deck] = new card(value,suit)
        drawDeck.push(this['card' + value + suit + deck]);
      }
*/



function beginGame(){
  
}

function tableuGen(){
   for(let i in tableu){
   let line = this['cleg' + i];
   //console.log(line);
   document.getElementById(ctableu[i]).innerHTML = 'yo';
   }
   
}

function showCursor (){
  let legNum = cursor.search;
  let output = [...this['cleg' + cursor.search]];
  let cardpos = output.length - cursor.searchDepth - 1
  //console.log(tableu[pcursor.leg][cardpos - 1]);
  output.splice(cardpos, 0,downArrow);
  //console.log(output);  
  document.getElementById('cleg' + legNum).innerHTML = '<div style="line-height:50%;">' + output.join('<br>') + '</div>';
}

function checkTopFace(){
  for(let i = 0;i <= game.legs - 1;i++){
    if(!tableu[i][tableu[i].length - 1].vis){tableu[i][tableu[i].length - 1].vis = "true"}
  }
}

////////////////////////////////////Layout\\\\\\\\\\\\\\\\\\\\\\\\
function layoutGen(){
  visualFoundationBuild()
  checkTopFace();
  if(drawDeck.length <= 0){document.getElementById('stock').innerHTML = '<button class="emptyStock">' + emptyCell + '</button>'}
  document.getElementById('stockNo').innerHTML = drawDeck.length;
  
  if(cursorMode == "stack"){this ['found' + foundation.indexOf(emptyCell)] = '<button height="14px" onclick="foundationPush()" class="invis"><span style="color:#B93E07;font-weight:bold;">^</span></button>'}
  if(cursorMode != "stack"){this ['found' + foundation.indexOf(emptyCell)] = emptyCell}
  
  foundRefresh();
  
  
  
  ///////////////////////legs/////////////////////////



  //document.getElementById('
  //document.getElementById('
  printLegs();
  if(cursorMode != 'listless'){showCursor()};
  ////////////////////Winning\\\\\\\\\\\\\\\\\\\\\\\\\\
  if(foundation.indexOf(emptyCell) == -1){
  document.getElementById('yi').innerHTML = '<table><tr><td>wow great game you did it</td></td></tr?<tr><td><button class="customSubmitButton" onclick="startOver()">Exit to Menu</button></td></tr></table>';
  console.log('win')
  
  }
}

const legDisplay= (leg,legNum) => {
  cardposition = 1;
  let length = leg.length;
  let output = leg.map(x => seaCards(x,legNum,length));
  this['cleg' + legNum] = output;
  return this['cleg' + legNum].join('<br>');
  //return output.join('<br>');
}

const topCard = (card,legNum) => {
  let extra = 'onClick="clickOn(' + cardposition + ',' + legNum + ')"';
  if(card.value == 10){return '<div class="topcard1" ' + extra + ' style="z-index:' + cardposition + '">' + card.value + '&nbsp;&nbsp;<br>' + card.suit + '<br>&nbsp;&nbsp;' + card.value + '</div>';}
  if(card.value =='Z'){return '<div class="topcard1" ' + extra + ' style="z-index:' + cardposition + '">' + ' ' + '&nbsp;&nbsp;<br>' + ' ' + '<br>&nbsp;&nbsp;' + ' ' + '</div>';}
  return '<div class="topcard1" onClick="clickOn(' + cardposition + ',' + legNum + ')" style="z-index:' + cardposition + '">' + cardDisplayValues[card.value] + '&nbsp;&nbsp;&nbsp;<br>' + card.suit + '<br>&nbsp;&nbsp;' + cardDisplayValues[card.value] + '</div>';
  
}

const notTop = (card,legNum) => {
  let extra = 'onClick="clickOn(' + cardposition + ',' + legNum + ')"';
  if(card.value == 10){return '<div class="notTop"' + extra + ' style="z-index:' + cardposition + '">' + card.value + "" + card.suit + '</div>'}
  if(card.value == 'Z'){return '<div class="notTop"' + extra + ' style="z-index:' + cardposition + '">' + '' + "" + '' + '</div>'}
  return '<div class="notTop"' + extra + ' style="z-index:' + cardposition + '">' + cardDisplayValues[card.value] + "&nbsp;" + card.suit + '</div>'
}

var cardDisplayValues = ['JK','A','2','3','4','5','6','7','8','9','10','J','Q','K'];

const seaCards = (card,legNum,length) => {
  if(card == 'bot' && length == 1){return '<button onclick="clickOn(0,' + legNum +')" class="invis">&#8224</button>'
  }else if(card == 'bot'){return ''}
  
  cardposition++;
  if(!card.vis){return faceDown}
  if(cardposition == length){return topCard(card,legNum)}
  return notTop(card,legNum)
}



function printLegs(){
  let output = []
  for(let i in tableu){
    let line = [...this['leg' + i]];
    //console.log(line);
    document.getElementById('cleg' + i).innerHTML = '<div style="line-height:50%;">' + legDisplay(line,i) + '</div>';
  }
}

/////////////////////////controls\\\\\\\\\\\\\\\\\\\\\\
function buttonPress (button) {
  
  if(cursorMode == 'listless') {cursorMode = 'search'}
  switch(button){
    case 87:
    case 38:
    case 111:
      butUp();
      break;
    case 65:
    case 37:
      butLeft();
      break;
    case 83:
    case 40:
    case 106:
      butDown();
      break;
    case 68:
    case 39:
      butRight();
      break;
    case 32:
    case 17:
    case 107:
      butAction();
      break;
    case 13:
    case 82:
      butDeal();
      break;
    case 49:
    case 97:
      warpS(0);
    	break;
    case 50:
    case 98:
      warpS(1);
      break;
    case 51:
    case 99:
      warpS(2);
      break;
    case 52:
    case 100:
      warpS(3);
      break;
    case 53:
    case 101:
      warpS(4);
      break;
    case 54:
    case 102:
      warpS(5);
      break;
    case 55:
    case 103:
      warpS(6);
      break;
    case 56:
    case 104:
      warpS(7);
      break;
    case 57:
    case 105:
      warpS(8);
      break;
    case 48:
    case 96:
      warpS(9);
      break;
    default:
      layoutGen();
      break;
  }
  if(cursor[cursorMode] <= -1){cursor[cursorMode] = game.legs -1}
  if(cursor[cursorMode] >= game.legs){cursor[cursorMode] = cursor[cursorMode] % game.legs}
  layoutGen();
}
function butDeal() {
  saveGame();
  cursorMode = 'listless';
  if(drawDeck.length <= game.legs){
  	deal(game.legs,true);
  	return;
  } else if(drawDeck.length > 0){
    if(game.relaxed == true){
      deal(game.legs, true)
    } else {newDeal(game.legs,true)}
  }
//  scursor = {...cursorStart};
//  pcursor = {...cursorStart};
  layoutGen();
}

function clickOn (cardpos,legNum) {
  //console.log(cardpos,legNum);
  if(cursorMode == 'stack'){
    cursor.stack = legNum;
    buttonPress(32);
  	cursorMode = 'listless';
  	layoutGen();
  	return;
  	} 
  //console.log(cursorMode);
  if(cursorMode != 'stack' && cardpos != 0){
  	cursorMode = 'search';
    pcursor.leg = legNum;
    pcursor.depth = tableu[legNum].length - cardpos - 1;
    cursor.search = legNum;
    cursor.searchDepth = 0;
    let depthTarget = tableu[legNum].length - cardpos;
    for(let i = 1;i <= depthTarget; i++){
      buttonPress(87)
    }
    buttonPress(32);
    
    
    showCursor();
    /*
    let output = [...this['cleg' + legNum]];
    console.log(tableu[legNum][cardpos - 1]);
    output.splice(cursor.searchDepth - 1, 0,downArrow);
	  //console.log(output);  
    document.getElementById('cleg' + legNum).innerHTML = '<div style="line-height:50%;">' + output.join('<br>') + '</div>';*/
  }
}

//player controls  wasd space enter/enternum
//87,65,83,68,32,13,13
function butUp() {
	if(cursorMode == 'search'){cursorUp()}
  if(cursorMode == 'stack'){suitCheck()}
}
function butLeft() {
  cursor[cursorMode]--;  
  if(cursorMode == 'search'){cursor.searchDepth = 0}
}
function butDown() {
	if(cursor.searchDepth != 0){cursor.searchDepth--}
}
function butRight() {
	cursor[cursorMode]++;
  if(cursorMode == 'search'){cursor.searchDepth = 0}
}
function butAction() {
	if(cursorMode == 'search'){
    grabStack();    
  }else {
    	if(cursorMode == 'stack'){
  			placeStack();
    		cursorMode = 'listless'
      }
  }	
}

////////////////////////6.0 new actions\\\\\\\\\\\\\\\\\\\\\\\\
function grabStack(){
  cursor.stack = cursor.search;
  cursorMode = 'stack';
}


function placeStack(){
  if(cursor.foundation == 0){
    matchCol();
  } else {
    foundationPush();
  }
  cursor.foundation = 0;
}

function foundationClick() {
  cursor.searchDepth = 1;
  buttonPress(32);
  }


var floatCards = [];
function stackCol() {
  for(let i in tableu){
    if(i == cursor.search){
      floatCards = this['leg' + i].splice(this['leg' + i].length - 1 - cursor.searchDepth);
    }
  }
  for(let i in tableu){
    if(i == cursor.stack){
      for(let card of floatCards){
        this['leg' + i].push(card);
      }
  	}
	}
  cursor.search = cursor.stack;
}


function matchCol() {
  let grabLeg = tableu[cursor.search];
  let dropLeg = tableu[cursor.stack];
  let grabLegTop = grabLeg[grabLeg.length - 1 - cursor.searchDepth];
  //console.log(grabLeg);
  //console.log(grabLegTop);
  let dropLegBottom = dropLeg[dropLeg.length - 1];
  //console.log(grabLegTop, dropLegBottom);
  if(dropLegBottom == 'bot' || grabLegTop.value == dropLegBottom.value - 1 || dropLegBottom.value == 'Z' || (game.kOnA == true && grabLegTop.value == highCard && dropLegBottom.value == 1) || grabLegTop.value == "Z" ) {

//  if(dropLegBottom == 'bot' || grabLegTop.value == dropLegBottom.value - 1 || dropLegBottom.value == '0' || (game.kOnA == true && grabLegTop.value == highCard && dropLegBottom.value == 1) || (game.kOnA == true && game.noFaceCards == true && grabLegTop.value == highCard && dropLegBottom.value == 1)) {
  
    //console.log('match');

  if(cursorMode == "stack"){this ['found' + foundation.indexOf(emptyCell)] = '<button height="14px" onclick="foundationPush()" class="invis"><span style="color:#B93E07;font-weight:bold;">^</span></button>'}
  if(cursorMode != "stack"){this ['found' + foundation.indexOf(emptyCell)] = emptyCell}
	  
    saveGame();
    stackCol();
    scursor = {leg:pcursor.leg,depth:0};
    
  } 
 	for(let grabLeg in tableu){
    if(grabLeg == scursor.leg){
  	}    
  }
}

var topCardSuit = '';
function cursorUp() {
  
  for(let i in tableu){
    if(i == cursor.search){
      let current = tableu[i][tableu[i].length - cursor.searchDepth - 1];
      let next = tableu[i][tableu[i].length - cursor.searchDepth - 2];
      //console.log('ho' , current);
      //console.log('hey' , next);
      if(current.value == next.value - 1 || current.value == 'Z' || next.value == 'Z' || (game.kOnA == true &&(current.value == highCard && next.value == 1) 
//      || (game.noFaceCards == true &&(current.value == 10 && next.value == 1))
)){
        if(current.suit == next.suit){
          topCardSuit = current.suit;
          //console.log('suit match');
          cursor.searchDepth++;
          cursor.searchDepth = cursor.searchDepth % tableu[i].length;
        }
      }
    }
  }
}
function foundRefresh(){
  for(let i in foundation){
    let line = 'found' + i
    document.getElementById(line).innerHTML = this['found' + i];
    }
}


function foundButt(){
  found[foundation.indexOf(emptyCell)] = '<button onClick="foundationPush" class="invis"><span style="color:#B93E07;font-weight:bold;">^</span></button>'
  foundRefresh();
}

	
const foundationSuit = (suit) => {
    if(suit == '\u{2665}' || suit == '\u{2666}'){
    suit = '<span style="color:#DF481C;">' + suit + '</span>';
  }
  return suit;
}

function foundationPush(){
  if(matchSuit() == true){
	//saveGame();
  	foundation[foundation.indexOf(emptyCell)] = foundationSuit(topCardSuit);
    foundRefresh();
    cursor.search = 0;
    cursor.searchDepth = 0;
    cursor.foundation = 0;
    cursorMode = 'listless';
    layoutGen();
    
  }
}

function matchSuit() {
  let grabLeg = tableu[cursor.search];
  let grabLegTop = grabLeg.slice(grabLeg.length - 1 - cursor.searchDepth);
  //console.log('grabLeg = ' + grabLeg + '\ngrabLegTop = ' + grabLegTop);
 
   if(grabLegTop[0].value == highCard && grabLegTop[grabLegTop.length - 1].value == 1){
   // console.log('full match')
     saveGame();
      tableu[cursor.search].splice(tableu[cursor.search].length - 1 - cursor.searchDepth);
      return true;
    	}
/*  
  if(!game.noFaceCards){
    if(grabLegTop[0].value == 13 && grabLegTop[grabLegTop.length - 1].value == 1){
   // console.log('full match')
      tableu[cursor.search].splice(tableu[cursor.search].length - 1 - cursor.searchDepth);
      return true;
    	}
    }
  if(game.noFaceCards && grabLegTop[0].value == 10 &&  grabLegTop[grabLegTop.length - 1].value == 1){
      	tableu[cursor.search].splice(tableu[cursor.search].length - 1 - cursor.searchDepth);
      	return true;
      }
 */   
}



function suitCheck() {
	cursor.foundation = 1;
}

function warpS(column) {
  if(cursorMode == 'search'){
    cursor.search = column;
    cursor.searchDepth = 0;
  } else{
    cursor.stack = column;
    cursor.foundation = 0;
  }
}
  
///////////////////////////////5.0 actions code\\\\\\\\\\\\\\\\\\\\\\\\

var keys = [];



///////////////////////////////NEW GAME\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
function newGame(){
document.addEventListener("keyup", function(e) {
  keys[e.keyCode] = false;
});

document.addEventListener("keydown", function(e) {  
  e.preventDefault(); // make sure this doesn't scroll the window
  keys[e.keyCode] = true;
  //console.log(e.keyCode);
  buttonPress(e.keyCode);
  }
 )

  document.getElementById('banana').innerHTML = '';
  console.log('building deck ');
  deckBuild();
  console.log('building draw deck');
  shuffle(drawDeck); 
  console.log('buildlayout');
  buildLayout();
  console.log(tableu);
  visualTableBuild();
  console.log('new game');
  layoutGen();
  console.log('leyout');
  newGameDeal();
  
  printLegs();
  layoutGen();

	////////////////// what the heck is going on here\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
	
  document.getElementById('yi').innerHTML = '<button class="customSubmitButton" onclick="startOver()">Exit to Menu</button> <button class="customSubmitButton" onclick="loadState(cookieold)">Load previous (cheat)</button>';
}
function startOver(){
document.getElementById('yo').innerHTML = '';
  mainMenu();
  document.getElementById('yi').innerHTML = '';
}

	
/* 
>log into youtube
>get ad to join the military
>scrub to begginging of video because it started in the middle
>immediately get another ad because youtube
>get dropped back in the middle of the video
>watch a third ad after scrubbing to the beggining
>enjoy 47 minutes and 46 seconds of Dire Straits - Brothers In Arms {Reissue} [Full Album] (HQ) without any other ads
>modern youtube experience

https://www.2000cranes.com/Kyoto-Mist/Hokanji-Temple.html
*/
	
//////////////////////////////////cookie area\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\
var lastState = {};
function makeState() {
  cookieold = {tableu: [], foundation: [], drawdeck: [], game: []};
  cookieDoc = {tableu: [], foundation: [], drawdeck: [], game: []};
}

var cookieCounter = 0;
		
var cookieold = [];
///   Start edit
var cookieDoc = [];

function compressSuit(string){
  return string.replaceAll(`<svg class=\\\"circle\\\" viewBox=\\\"0 0 150 150\\\" height=\\\".6em\\\" width=\\\".6em\\\" style=\\\"align-items: center;\\\"><use xlink:href=\\\"` , `#suit`)
}
function decompressSuit(string){
  return string.replaceAll(`#suit`,`<svg class=\\\"circle\\\" viewBox=\\\"0 0 150 150\\\" height=\\\".6em\\\" width=\\\".6em\\\" style=\\\"align-items: center;\\\"><use xlink:href=\\\"`)
}	
	
function saveState() {
  cookieold.game.push(JSON.stringify(this['game']));
  cookieDoc.game.push(JSON.stringify(this['game']));
  cookieold.drawdeck.push(JSON.stringify(this['drawDeck']));
	cookieDoc.drawdeck.push(JSON.stringify(this['drawDeck']));
  for(let i = 0;i <= legs-1;i++){
    cookieold.tableu.push(JSON.stringify(this['leg' + i]));
		cookieDoc.tableu.push(JSON.stringify(this['leg' + i]));
  }
  for(let i = 0;i <= foundation.length-1;i++){
    cookieold.foundation.push(JSON.stringify(this['found' + i]));
		cookieDoc.foundation.push(JSON.stringify(this['found' + i]));
  }
}

///edite

function saveGame() {
  makeState();
  saveState();
  removeCookies();
  zipNsip('zip');
  putCookie();
  cookieCounter = cookieCounter == 0 ? 1 : 0;
}

/// will need to get a method of the game recognizing when a new cookie should be made.  Right now, useing a plethora of commands: removeCookies() clears cookies, saveGame() makes a blank cookieold then a new cookieold (stupid), removeCookies() again, 
/// then encodeCook() clears temporaryCookieArray and writes a new one encoded in base64 then pushes each cell to the document.cookie.  this results in a mess of numbered cookies.  Decode pulls the cookie and puts it in a just cleared
/// pulledCookieArray and UNbase64s that to decodedVar.  To load the state, decodeVar must be PARSED to a new cookie, which is currently called "cookieold" which is how loadState() is currently written, so another function will have to do this or
/// loadState() could just use decodedVar instead.  Maybe loadState() could parse.decodedVar then load from that (obvious next step, should consider).
/// also to do:  how does the game know when to clear state and when to load a new one?  if it clears the state each time then you would not be able to go backwards, only to the current state.  this would be fine for reloading a game, but 
/// not for moving back a step.  I could just use local memory for that, since its easier than a cookie, also, I don't even need local memory, I can just make a "previousState" var and rewrite that with each step.  This is the easy and logical solution.


////////////////  ZIPPPER \\\\\\\\\\\\\\\\\\\\\\
	
var zipCardSuit =['#spade','#heart','#club','#diamond','#bell','#acorn','#fish','#sun'];
var zipCardValue = {a:"1",b:"2",c:"3",d:"4",e:"5",f:"6",g:"7",h:"8",i:"9",j:"10",k:"11",l:"12",m:"13",z:"z"};
var zipCardFix = [`{\"suit\":\"<svg class=\\\"circle\\\" viewBox=\\\"0 0 150 150\\\" height=\\\".6em\\\" width=\\\".6em\\\" style=\\\"align-items: center;\\\"><use xlink:href=\\\"`,`\\\"/></svg>&nbsp;&nbsp;\",\"value\":\"`,`\\",\\"vis\\":true`,`","vis":true`]

function zipCard(str){
  let a = str.replaceAll(zipCardFix[0],``);
  let b = a;
  for(let i in zipCardSuit){
    b = b.replaceAll(zipCardSuit[i],(`#` + i))
    console.log(zipCardSuit[i]);
  }
  let c = b.replaceAll(zipCardFix[1],`#v`);
  let d = c.replaceAll(zipCardFix[3],`#t`);
  return d;
}

function unzipCard(str){
  let a = str.replaceAll(`#t`,zipCardFix[3]);
  let b = a.replaceAll(`#v`,zipCardFix[1]);
  let c = b;
  for(let i in zipCardSuit){
    c = c.replaceAll((`#` + i), (zipCardFix[0] + zipCardSuit[i]));
  }
  return c;
}

//var zipCardFox = [`{\\"suit\\":\\"<svg class=\\\\\\"circle\\\\\\" viewBox=\\\\\\"0 0 150 150\\\\\\" height=\\\\\\".6em\\\\\\" width=\\\\\\".6em\\\\\\" style=\\\\\\"align-items: center;\\\\\\"><use xlink:href=\\\\\\"`,`\\\\\\"/></svg>&nbsp;&nbsp;\\",\\"value\\":\\"`,`\\",\\"vis\\":true}`,`\\",\\"vis\\":true}`,`\\",\\"vis\\":false}`,`"\\"&#8224\\""`,`'"<button height=\\"14px\\" onclick=\\"foundationPush()\\" class=\\"invis\\"><span style=\\"color:#B93E07;font-weight:bold;\\">^</span></button>"'`]
var zipCardFox = [`{\\"suit\\":\\"<svg class=\\\\\\"circle\\\\\\" viewBox=\\\\\\"0 0 150 150\\\\\\" height=\\\\\\".6em\\\\\\" width=\\\\\\".6em\\\\\\" style=\\\\\\"align-items: center;\\\\\\"><use xlink:href=\\\\\\"`,`\\\\\\"/></svg>&nbsp;&nbsp;\\",\\"value\\":\\"`,`\\",\\"vis\\":true}`,`\\",\\"vis\\":true}`,`\\",\\"vis\\":false}`,`"\\"&#8224\\""`,`ton height=\\\\\\"14px\\\\\\" onclick=\\\\\\"foundationPush()\\\\\\" class=\\\\\\"invis\\\\\\"><span style=\\\\\\"color:#B93E07;font-weight:bold;\\\\\\">^</span></but`]
	
function zipCard2(str){
  let z = str.replaceAll(zipCardFox[6],`#y`);	
  let a = z.replaceAll(zipCardFox[0],``);
  let b = a;
  for(let i in zipCardSuit){
    b = b.replaceAll(zipCardSuit[i],(`#` + i))
    console.log(zipCardSuit[i]);
  }
  let c = b.replaceAll(zipCardFox[1],`#v`);
  let d = c.replaceAll(zipCardFox[3],`#t`);
  let e = d.replaceAll(zipCardFox[4],`#x`);

  return e;
}

function unzipCard2(str){
  let z = str.replaceAll(`#y`,zipCardFox[6]);	
  let a = z.replaceAll(`#t`,zipCardFox[3]);
  let b = a.replaceAll(`#v`,zipCardFox[1]);
  let c = b;
  for(let i in zipCardSuit){
    c = c.replaceAll((`#` + i), (zipCardFox[0] + zipCardSuit[i]));
  }
  c = c.replaceAll(`#x`,zipCardFox[4]);
  return c;
}

var cookie22 = '';

function zipNsip(status){
//zip or sip
  if(status == 'sip'){
    loadState(JSON.parse(unzipCard2(cookie22)))
	}
  if(status == 'zip'){
    cookie22 = zipCard2(JSON.stringify(cookieDoc))
	}
}
	
function putCookie(cookie) {
  temporaryCookieArray = [];
  temporaryCookieArray = chunkString(cookie22,200);
  for (i in temporaryCookieArray){
    document.cookie='goopisss' + ('00' + i).slice(-3) + "=" + temporaryCookieArray[i] + '; max-age=8640000000000; path=/;';
	}	
}  
	
////////////////  END ZIPPPER \\\\\\\\\\\\\\\\\\\\\\
function loadState(cookie) {
	if(cookie == ''){return};
	game = JSON.parse(cookie.game);
  for(let i = 0;i <= game.legs-1;i++){
    console.log(i);
    this['leg' + i] = JSON.parse(cookie.tableu[i]);
  }
  for(let i = 0;i <= game.decks-1;i++){
    let fx = JSON.parse(cookie.foundation[i]);
	console.log('' + fx + '' + i);
	if(fx.indexOf('button') == true){fx = emptyCell}
	console.log(fx);
    foundation[i] = fx; 
	console.log(foundation[i]);
  }
  drawDeck = JSON.parse(cookie.drawdeck);
  for(let i = 0;i <= game.legs-1;i++){
    tableu[i] = this['leg' + i];
  }
  layoutGen();
  for(let i = 0;i <= game.legs-1;i++){
    tableu[i] = this['leg' + i];
  }
	if(drawDeck.length >= 1){document.getElementById('stock').innerHTML = '<button class=faceDownCard onclick="buttonPress(13)">...</button>'}
  layoutGen();
  cookieCounter = cookieCounter == 0 ? 1 : 0;
  
}


	
//layoutGen();
	
function getAlltheCookies() {
  return document.cookie.split(';').map(cookie => cookie.split('=')).reduce((accumulator, [key, value]) => ({ ...accumulator, [key.trim()]: (value) }),{});
}

function loadCookie(){
  let tempC1 = getAlltheCookies();
  let tempC2 = '';
  for(let i in tempC1){
    tempC2 = tempC2 + tempC1[i];
    }
  return tempC2;
}
var tempC = '';
function getGame(){
  cookie22 = loadCookie();
  tempC = JSON.parse(cookie22);
  //game = JSON.parse(tempC.game);
}
	
function getCookie(cname) {
  let name = cname + "=";
  let decodedCookie = decodeURIComponent(document.cookie);
  let ca = decodedCookie.split(';');
  for(let i = 0; i <ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') {
      c = c.substring(1);
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length);
    }
  }
  return "";
}

function removeCookies() {
	 var res = document.cookie;
	 var multiple = res.split(";");
	 for(var i=0;i<multiple.length;i++) {
			var key = multiple[i].split("=");
			document.cookie=key[0]+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC";
	 }
}

var encodedVar = '';
var temporaryCookieArray = [];
var pulledCookieArray = [];
var decodedVar = '';
function encodeCook(theCook){
	temporaryCookieArray = [];
  encodedVar = btoa(JSON.stringify(theCook));
	temporaryCookieArray = chunkString(encodedVar,200);
	for (i in temporaryCookieArray){
    document.cookie='goopisss' + ('00' + i).slice(-3) + "=" + temporaryCookieArray[i];
	}	
}
	
function saveTempCookie(theCook){
  for (i in theCook){
    document.cookie=i + "=" + theCook[i];
  }
}
	
function decode(){
	pulledCookieArray = [];
  for (i in temporaryCookieArray){
		pulledCookieArray.push(getCookie(i));
  }
	decodedVar = atob(pulledCookieArray.join(''));
}
	

function chunkString (str, len) {
  const size = Math.ceil(str.length/len)
  const r = Array(size)
  let offset = 0
  
  for (let i = 0; i < size; i++) {
    r[i] = str.substr(offset, len)
    offset += len
  }
  
  return r
}
	
</script>

</html>
<!DOCTYPE html>

<title></title>
<body>




<script type="text/javascript">
console.log("beginning of script");



</script>
</body>
</html>
